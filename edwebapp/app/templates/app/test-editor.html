<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
        <title>Tests</title>
        {% load static %}
        {% load app_tags %}
        <link rel="icon" href="{% static 'app/img/logo_main.png'  %}">
        <link rel="stylesheet" href="{% static 'app/css/main.css' %}">
    </head>
<body>

    {% show_header username name %}


    <div class="d-flex justify-content-center p-2">
        <ul class="nav nav-pills">
            {% if is_published %}
            <li class="nav-item"><a href="{% url 'test_publish' test.code %}" class="w-100 btn btn-secondary btn-md btn-block">Зупинти публікування</a></li>
            {% else %}
            <li class="nav-item"><a href="{% url 'test_publish' test.code %}" class="w-100 btn btn-success btn-md btn-block">Опублікувати</a></li>
            {% endif %}
            <li class="nav-item"><a href="{% url 'test_statistic' test.code %}" class="nav-link text-dark">Переглянути статистику</a></li>
        </ul>
    </div>
    <hr class="my-1">

    {% if not is_published %}
    <div class="container my-4">
        <div class="p-3 mode">
            <div class="row">
                <h1 class="text-center text-body-emphasis">
                    Створити завдання
                    <button id="show-form" class="btn btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#form-add" aria-expanded="false" aria-controls="form-add">
                        <i id="plus" class="bi bi-plus-lg"></i>
                        <i id="c-up" class="bi bi-chevron-up hidden-element"></i>
                    </button>
                </h1>

                <div id="form-add" class="col-md-6 mx-auto collapse">
                    {% block task_form_content %}
                    <form method="POST">
                        {% csrf_token %}
                        {{ form.question_text }}

                        <hr class="my-3">
                        {{ form.answers.management_form }}
                        <div id="answer-forms">
                            {% for answer_form in form.answers.forms %}
                            <div class="answer-form">
                                <div class="row gy-3 my-2">
                                    <div class="col-md-9">
                                        {{ answer_form.answer_text }}
                                        {{ answer_form.is_correct }}
                                        <label for="{{ answer_form.is_correct.id_for_label }}">Правильна відповідь:</label>
                                    </div>
                                    <div class="col-md-3">
                                        <a class="w-100 btn btn-danger btn-md btn-block delete-answer">Видалити</a>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        <hr class="my-4">
                        <div class="row">
                            <div class="col-md-6 text-center">
                                <a type="button" id="add-answer" class="w-100 btn btn-primary btn-lg btn-block">Додати варіант</a>
                            </div>
                            <div class=" col-md-6 text-center">
                                <button type="submit" class="w-100 btn btn-success btn-lg btn-block">Зберегти завдання</button>
                            </div>
                        </div>
                    </form>
                    {% endblock %}
                </div>

            </div>
        </div>
    </div>
    {% endif %}

    <div class="container my-4"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <script src="{% static 'app/js/copy-clipboard.js' %}"></script>
    <script src="{% static 'app/js/dropdown-menu.js' %}"></script>
    <script>
        var formCount = {{ form.answers|length }};
        var addButton = document.getElementById("add-answer");
        var answerForms = document.getElementById("answer-forms");

        function deleteAnswerForm() {
            var answerForm = this.parentElement.parentElement.parentElement;
            answerForm.parentNode.removeChild(answerForm);
        }

        function addAnswerForm() {
            var answerForm = '{{ form.answers.empty_form|escapejs }}';
            answerForm = answerForm.replace(/__prefix__/g, formCount);
            formCount++;

            var newAnswerDiv = document.createElement('div');
            newAnswerDiv.classList.add('answer-form');
            num = formCount-1
            newAnswerDiv.insertAdjacentHTML('beforeend',
             '<div class="row gy-3 my-2">' +
                '<div class="col-md-9">' +
                    '<textarea name="answer-'+ num +'-answer_text" rows="1" class="form-control" placeholder="Введіть варіант відповіді" maxlength="255" id="id_answer-'+ num +'-answer_text"></textarea>' +
                    '<input type="checkbox" name="answer-'+ num +'-is_correct" id="id_answer-'+ num +'-is_correct">' +
                    '<label for="{{ answer_form.is_correct.id_for_label }}">Правильна відповідь</label>' +
                '</div>' +
                '<div class="col-md-3">' +
                    '<a class="w-100 btn btn-danger btn-md btn-block delete-answer">Видалити</a>' +
                '</div>' +
            '</div>');
            var newDeleteButton = newAnswerDiv.querySelector(".delete-answer");
            newDeleteButton.addEventListener("click", deleteAnswerForm);
            answerForms.appendChild(newAnswerDiv);
            autosize(document.querySelectorAll('textarea.form-control'));
        }

        addButton.addEventListener("click", addAnswerForm);

        var deleteButtons = document.querySelectorAll(".delete-answer");
        deleteButtons.forEach(function(button) {
            button.addEventListener("click", deleteAnswerForm);
        });

    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/autosize.js/4.0.2/autosize.min.js"></script>
    <script>
      autosize(document.querySelectorAll('textarea.form-control'));
    </script>

</body>
</html>


